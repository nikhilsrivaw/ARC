import pool from './pool'
import Logger from '@arc/logger';


 const logger = new Logger({
    serviceName: 'database',
    logLevel : 'DEBUG',
    enableConsole : true,
    enableFile: false

 });


class Database{
     async query(tenantId: string , sql: string , params?: any[] ) : Promise<any>{
        const client = await pool.connect();

        try {
           
             await client.query('SET search_path = $1' ,[tenantId]);
             
             const result = await client.query(sql , params || []);

             
             logger.debug('Query executed' , {tenantId , sql });

             return result.rows;
        } catch (error) {
           logger.error('database query failed ', {
            tenantId,
            sql,
            error: error instanceof Error ? error.message : String(error),
           });
           throw error
            
        }finally{
            client.release();
        }
     }
}

 export default new Database();